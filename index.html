<!DOCTYPE html>
<html>

<head>

  <link rel="stylesheet" type="text/css" href="dropdown.css">
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script>
  <script type="text/javascript" src="spotify-web-api-js.js"></script>
  <script type="text/javascript" src="search.js"></script>

    <meta charset="UTF-8">
    <title>Sample FirebaseUI App</title>
    <!-- *******************************************************************************************
       * TODO(DEVELOPER): Paste the initialization snippet from:
       * Firebase Console > Overview > Add Firebase to your web app. *
       ***************************************************************************************** -->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.css" />
    <script type="text/javascript">

        var token='BQBbVAIeze7SxXxH1-e80iVmx0ktlMOKFf6lgFYKo6OT6feycju2-UaA1jCXHXBgnqsNUWbxAMBrqAIWMmeHJyg8z6M-HChKMQZ94EFco27pHHXVdib1JNYSrAOqklA-dr5lrBaOwJBQWUQgRxbUzaiN8RBh9iOZN50y49AIEMIFiKSMqm6rhpl3IjrViP1IL7ggo3jbujuQmFTZPWu6JP39PG0TVAnmcEu2wHRUG23fO13wyy6Wdi4ntvoFajOCiF54HAtJldZQj_gZYRCPzv-chwUV3uoHUVss28w';
        var playlistid='2ysn3h0Vmkb4sqmCDyCgqO';
        var user_uri='22wzuycdg3qep6pwszio7pizi';
        var song=[]
        var playlists=[];
        var map={};
        var selected_playlist;

        // FirebaseUI config.
        var uiConfig = {
            signInSuccessUrl: '<url-to-redirect-to-on-success>',
            signInOptions: [
                // Leave the lines as is for the providers you want to offer your users.
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                firebase.auth.FacebookAuthProvider.PROVIDER_ID,
                firebase.auth.TwitterAuthProvider.PROVIDER_ID,
                firebase.auth.GithubAuthProvider.PROVIDER_ID,
                firebase.auth.EmailAuthProvider.PROVIDER_ID,
                firebase.auth.PhoneAuthProvider.PROVIDER_ID,
                firebaseui.auth.AnonymousAuthProvider.PROVIDER_ID
            ],
            // tosUrl and privacyPolicyUrl accept either url string or a callback
            // function.
            // Terms of service url/callback.
            tosUrl: '<your-tos-url>',
            // Privacy policy url/callback.
            privacyPolicyUrl: function() {
                window.location.assign('<your-privacy-policy-url>');
            }
        };
        // Initialize the FirebaseUI Widget using Firebase.
        var ui = new firebaseui.auth.AuthUI(firebase.auth());
        // The start method will wait until the DOM is loaded.
        ui.start('#firebaseui-auth-container', uiConfig);

        function getUserPlaylists() {

          var spotifyApi = new SpotifyWebApi();
          spotifyApi.setAccessToken(token);

          spotifyApi.getUserPlaylists()  // note that we don't pass a user id
            .then(function(data) {
            console.log('User playlists', data);

            console.log(data["items"][0]["name"]);

            for(var i=0; i < 5; i++){
              //playlists stores the uri of each playlist

              playlists.push(data["items"][i]["uri"]);

              //this is a map of the uri of the playlist to the name of the playlist
              map[playlists[i]]=data["items"][i]["name"];
              var p= "playlist"+ i;
              document.getElementById(p).innerHTML = map[playlists[i]];


              console.log(playlists[i]);
              console.log;
            }

            }, function(err) {
            console.error(err);
            });
        }

        function choosePlaylists(index) {
          selected_playlist=playlists[index];
          console.log(selected_playlist);
          return (selected_playlist);
}

function create() {

  var spotifyApi = new SpotifyWebApi();
  spotifyApi.setAccessToken(token);

  var playlist_name = prompt("Please enter a name for your playlist:", "new playlist!!");


  var name={
  "name": playlist_name,
  "description": "New playlist description",
  "public": true
  }

  spotifyApi.createPlaylist(name)
  .then(function(new_playlist) {
    console.log('Playlist Created!', new_playlist);
    selected_playlist=new_playlist["uri"];
    console.log(new_playlist["uri"]);

  }, function(err) {
    console.error(err);
  });

return selected_playlist;
}
    </script>
</head>
<body>
    <!-- The surrounding HTML is left untouched by FirebaseUI.
         Your app may use that space for branding, controls and other customizations.-->
    <h1>Create a playlist or choose an existing one! </h1>
    <div id="firebaseui-auth-container"></div>
    <p> </p>
    <div class="dropdown">

      <script> getUserPlaylists();
      </script>

<h3> Select Playlist </h3>
<button onclick="create()"> <h3>  Create a Playlist </h3> </button>
<p> </p>
  <button class="dropbtn"> All Playlists</button>
  <div class="dropdown-content">
    <a href="#" onclick="choosePlaylists(0)"> <div id="playlist0"> </div> </a>
    <a href="#" onclick="choosePlaylists(1)"> <div id="playlist1"> </div></a>
    <a href="#" onclick="choosePlaylists(2)"> <div id="playlist2"> </div></a>
    <a href="#" onclick="choosePlaylists(3)"> <div id="playlist3"> </div> </a>
    <a href="#" onclick="choosePlaylists(4)"> <div id="playlist4"> </div> </a>
</div>


  </body>
  </html>
