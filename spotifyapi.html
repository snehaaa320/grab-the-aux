<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8"/>
  <!-- <script type="text/javascript" src="spotifyapi.js"></script> -->
  <link rel="stylesheet" type="text/css" href="style.css">
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="https://requirejs.org/docs/release/2.3.6/minified/require.js"></script>
  <script type="text/javascript" src="spotify-web-api-js.js"></script>
  <script type="text/javascript" src="search.js"></script>

</head>
<body>

  <form autocomplete="off" accept-charset=utf-8>
    <h1> search bar in progress. </h1>

    <div class="autocomplete" style="width:300px;">
    <input id="mysong" type="search" name="mysong" placeholder="Songs" value="hello">
    </div>

  <script>
  //token hard coded right now. when we get authorization working it will be passed into the functions

  var token='BQDKhkhX845cDjg8fx-DpNgcRzX6lR6DNM4JvLOwz6GyvCyWWlt4M17HFW4Z02XqOutqnPnDMjK8-lSm0qvFpraz0yXtABuvhVoalgaNtCaMFnSoyi9alHcDMak4KrErdQzbvIbGuZEYEtxH3thgUc0drwfyaSY4iKfTAPCECTDgCL9kkgOXNRILzrpHOEL6HpBK97G0Ppi5pBGhGfW4ub9DbJlr0UcBBaM';
  var playlistid='7qJCpxOofNiYv0iUbqR4D0';
  var user_uri='22wzuycdg3qep6pwszio7pizi';
  var tracks=[];
  var song=[]
  var songs = ["Taki Taki - DJ Snake", "Happier - Bastille, Marshmello", "I Like Me Better -Lauv", "Party In The USA- Miley Cyrus", "Wonderwall- Oasis", "Mr. Brightside- The Killers"]
  autocomplete(document.getElementById("mysong"), songs);

    //var song = prompt("Please enter a song", "song goes here");
  function start(token) {
    var spotifyApi = new SpotifyWebApi();
    spotifyApi.setAccessToken(token);
    var s=document.getElementById("mysong").value;

    spotifyApi.getUser(user_uri)
    .then(function(data) {
      console.log('User data:', data);
      console.log(data["display_name"]);
    }, function(err) {
      console.error(err);
    });


    //display top 10 tracks
    spotifyApi.searchTracks(s)
        .then(function(data) {
          console.log('Search result:', data);
          console.log(data["tracks"]["items"][0]["name"]);
          console.log(data["tracks"]["items"][0]["artists"][0]["name"]);
          console.log(data["tracks"]["items"][0]["uri"]);

          var uri=data["tracks"]["items"][0]["uri"];

          var map={};
          song.push(uri);

          for(var i=0; i < 3; i++){
            tracks.push(data["tracks"]["items"][i]["uri"]);
            var current=data["tracks"]["items"][i]["artists"][0]["name"];

            if(data["tracks"]["items"][i]["artists"][0]["name"]== 'null')
              break;

            map[tracks[i]]=data["tracks"]["items"][i]["name"] + "-" + data["tracks"]["items"][i]["artists"][0]["name"];
          }

          document.getElementById('tracks').innerHTML= "<h3> Search Results: </h3>";

          for (i = 0; i < 3; i++) {
            document.getElementById('tracks').innerHTML +=  map[tracks[i]] + "<br>";
          }
          document.getElementById('success').innerHTML = "Your search contains valid Spotify track(s) that can be added to the playlist!";

        }, function(err) {
          console.error(err);
        });

    }

    function addToPlaylist(song, token){
      var spotifyApi = new SpotifyWebApi();
      spotifyApi.setAccessToken(token);

      spotifyApi.addTracksToPlaylist(playlistid, song)
      .then(function(playlist) {
        console.log('Track added!', playlist);
      }, function(err) {
        console.error(err);
      });
    }

  </script>

</form>

<button type="submit" onclick="start(token)"> Search for a Song </button>
<div id="success"> </div>
<div id="tracks">
</div>
<button type="submit" onclick="addToPlaylist(song, token)"> Add to playlist </button>
<p> </p>



<script>

window.onload=function{
    document.getElementById("iframeurl").src =
              "https://open.spotify.com/embed/user/22wzuycdg3qep6pwszio7pizi/playlist/7qJCpxOofNiYv0iUbqR4D0";
}

</script>

<iframe id="iframurl" scrolling="yes" height="350" width ="350" src="https://open.spotify.com/embed/user/22wzuycdg3qep6pwszio7pizi/playlist/7qJCpxOofNiYv0iUbqR4D0"></iframe>

</html>
